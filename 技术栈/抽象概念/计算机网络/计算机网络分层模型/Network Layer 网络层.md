# 网络层概览
**网络层**（**N**etwork **L**ayer）是[[OSI七层模型|OSI模型]]中的第三层（[TCP/IP](https://zh.wikipedia.org/wiki/TCP/IP%E5%8D%8F%E8%AE%AE%E6%97%8F "TCP/IP协议族")模型中的网际层），提供[路由](https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1 "路由")和寻址的功能，使两终端系统能够互连且决定最佳路径，并具有一定的拥塞控制和流量控制的能力。相当于发送邮件时需要地址一般重要。由于TCP/IP协议体系中的网络层功能由IP协议规定和实现，故又称IP层。

# IPV4协议
### IPv4 分组核心笔记

#### **一、分组结构**

IPv4 分组由 **20~60字节的首部**和**最大65515字节的数据部分**组成。首部固定部分（20字节）包含核心控制字段，可变部分（0~40字节）用于扩展功能。关键字段协同工作：

- **版本**（4bit）标识IPv4/v6；
    
- **首部长度**（4bit，×4B单位）决定首部大小（20~60B）；
    
- **总长度**（16bit，×1B单位）定义分组总字节数；
    
- **标识+标志+片偏移** 共同管理分片机制；
    
- **TTL** 控制分组生命周期，**协议**字段指示上层协议类型（如TCP/UDP）。
    

> **首部校验和**仅校验首部，算法与UDP一致，校验失败则丢弃分组。

---

#### **二、分片机制（MTU约束）**

当分组长度超过下一跳链路 **MTU**（如以太网1500B）时，路由器或源主机触发分片：

1. **分片规则**
    
    - 分片仅在**终点主机重组**，中途不重组
        
    - 每个分片均为独立IP分组（含完整首部）
        
    - **非末片数据长度必须为8B整数倍**（因片偏移以8B为单位）
        
2. **字段协作**
    
    - **标识符**相同 → 标记同属原始分组
        
    - **MF位**：1=后续有分片，0=末片
        
    - **DF位**：1=禁止分片（触发ICMP错误）
        
    - **片偏移** = 原始数据位置 / 8
        

**实例**：3980B数据（MTU=1500B）

- 分片1：1480B数据（偏移0，MF=1）
    
- 分片2：1480B数据（偏移185×8=1480B，MF=1）
    
- 分片3：1020B数据（偏移370×8=2960B，MF=0）
    

---

#### **三、TTL与ICMP控制环**

**TTL（生存时间）** 由源主机设置初始值（常为64/128），每经路由器减1：

- **TTL=0** → 丢弃分组 + 向源端发送 **ICMP超时报文（Type 11）**
    
- **ICMP** 同步传递其他异常（如目的不可达、参数错误等）
    

> 此机制本质是网络层的**故障熔断策略**，防止分组因路由环路无限滞留。

---

#### **四、核心计算与易错点**

|**字段**|**计算规则**|**实例**|
|---|---|---|
|首部长度|值×4B|5 → 20B|
|总长度|直接字节数|1500 → 1500B|
|片偏移|值×8B = 原始数据位置|185 → 1480B位置|
|分片数据长|非末片需满足 长度 mod 8 = 0|1480B合规，1482B错误|

**高频陷阱**：

1. 分片时仅复制原始首部，但更新**标志/片偏移**；
    
2. TTL归零时**当前路由器**负责发送ICMP，非终点；
    
3. 数据长度 = 总长度 - 首部长度（如总长48B、首部20B → 数据28B）。

# IPV6协议


# 网络层辅助协议


# 路由技术


# 高级网络层技术
