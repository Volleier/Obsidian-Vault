刚体动力学是物理学中的一个分支，专注于研究刚体在受到外力和扭矩时的运动行为。在游戏开发中，刚体动力学用于模拟物体的物理运动，包括它们如何在三维空间中移动和旋转。刚体动力学不仅考虑物体的运动，还包括碰撞、反弹、摩擦等各种物理现象。通过对刚体动力学的计算，游戏中的物体可以表现出逼真的物理行为。

### 刚体动力学的核心概念

#### 1. 刚体的基本属性
- 质量（Mass）：刚体的质量决定了它在受到力作用时的加速度大小。质量越大，物体越难加速或减速。
- 惯性张量（Inertia Tensor）：决定了物体在不同轴上的旋转惯性，影响它在受力时如何旋转。惯性张量取决于物体的质量分布和形状。
- 位置（Position）：物体在三维空间中的坐标。
- 旋转（Rotation）：物体相对于某一参考系的旋转状态，通常通过四元数或欧拉角来表示。

#### 2. 动量与角动量
- 线性动量（Linear Momentum）：定义为物体的质量与其速度的乘积，表示物体在直线运动中保持其速度的倾向。
    - 公式：\( p = mv \)，其中 \( p \) 是动量，\( m \) 是质量，\( v \) 是速度。
  
- 角动量（Angular Momentum）：定义为物体的惯性张量与角速度的乘积，表示物体在旋转运动中保持其旋转的倾向。
    - 公式：\( L = I \omega \)，其中 \( L \) 是角动量，\( I \) 是惯性张量，\( \omega \) 是角速度。

#### 3. 牛顿定律与运动方程
- 牛顿第二定律：
    - 线性运动：刚体的加速度由外力决定，公式为 \( F = ma \)，其中 \( F \) 是外力，\( m \) 是质量，\( a \) 是加速度。
    - 旋转运动：刚体的角加速度由扭矩决定，公式为 \( \tau = I \alpha \)，其中 \( \tau \) 是扭矩，\( I \) 是惯性张量，\( \alpha \) 是角加速度。
  
#### 4. 刚体的运动分解
刚体的运动可以分为两部分：平移运动和旋转运动。

- 平移运动：由物体的质心位置变化决定，受线性力（如重力、推动力）影响。
- 旋转运动：由物体围绕其质心的旋转状态决定，受扭矩影响。不同的扭矩作用于物体时，物体会产生不同的旋转行为。

### 刚体动力学的计算

#### 1. 线性动力学
线性动力学描述物体的平移运动，通常由外力推动物体在空间中移动。

- 外力（Force）：施加在物体上的外力可以改变其速度和位置。
- 加速度（Acceleration）：由外力产生的加速度通过牛顿第二定律计算得出。
- 速度更新：物体的速度根据当前加速度逐步更新，公式为 \( v = v_0 + a \Delta t \)，其中 \( v \) 是新的速度，\( v_0 \) 是初始速度，\( a \) 是加速度，\( \Delta t \) 是时间步长。
- 位置更新：物体的位置根据当前速度逐步更新，公式为 \( x = x_0 + v \Delta t \)，其中 \( x \) 是新的位置，\( x_0 \) 是初始位置。

#### 2. 角动力学
角动力学描述物体的旋转运动，旋转状态由外力产生的扭矩决定。

- 扭矩（Torque）：扭矩是作用在物体上的力矩，公式为 \( \tau = r \times F \)，其中 \( r \) 是力的作用点到旋转轴的距离，\( F \) 是施加的力。
- 角加速度（Angular Acceleration）：由扭矩产生的角加速度通过公式 \( \alpha = \tau / I \) 计算得出。
- 角速度更新：物体的角速度根据当前角加速度更新，公式为 \( \omega = \omega_0 + \alpha \Delta t \)，其中 \( \omega \) 是新的角速度，\( \omega_0 \) 是初始角速度。
- 旋转更新：物体的旋转状态通过四元数或旋转矩阵更新。

### 刚体碰撞与反应

#### 1. 碰撞检测（Collision Detection）
- 连续碰撞检测（Continuous Collision Detection）：用于防止快速移动的物体穿透其他物体，通过在每帧中进行多次检查，确保碰撞不会错过。
- 离散碰撞检测（Discrete Collision Detection）：每一帧计算物体的位置并检查是否发生碰撞，适合慢速移动的物体。

#### 2. 碰撞反应（Collision Response）
- 弹性碰撞：碰撞后物体反弹，遵循动量守恒和能量守恒定律。
- 非弹性碰撞：碰撞后物体的能量部分损失，反弹高度减少，甚至完全停下来。
- 反弹系数（Coefficient of Restitution）：决定物体碰撞后的反弹力度，取值范围为0到1，1表示完全弹性碰撞，0表示完全非弹性碰撞。

#### 3. 冲量（Impulse）
- 定义：冲量是指在极短时间内作用于物体的力，通常用于处理刚体碰撞。
- 计算公式：\( J = \Delta p \)，其中 \( J \) 是冲量，\( \Delta p \) 是动量的变化量。通过冲量，物体的速度可以在瞬间发生改变。

### 刚体动力学在游戏中的应用

#### 1. 角色物理
- 角色控制器：角色通常被模拟为胶囊形状的刚体，通过动力学计算行走、跳跃、碰撞等物理行为。
- 运动模拟：角色受重力、摩擦力等物理力影响，表现出自然的加速和减速效果。

#### 2. 物体交互
- 推动和拉动：玩家可以通过施加外力推动或拉动物体，物体根据动力学计算进行运动。
- 抛掷物：抛掷物体的运动轨迹由物理引擎通过刚体动力学计算，考虑了重力和空气阻力等因素。

#### 3. 物理谜题
- 摇摆与摆动：物体的运动方式如摆动和旋转，可以通过刚体动力学来模拟，例如钟摆、荡秋千等物理机制。
- 多米诺骨牌效应：多个刚体物体相互作用，形成连锁反应，这种效果依赖精确的刚体动力学模拟。

### 动力学中的优化

#### 1. 睡眠机制（Sleeping Mechanism）
当物体停止移动一段时间后，物理引擎会将其置于睡眠状态，停止其物理计算，直到再次受到外力或碰撞。这样可以大大减少计算开销，提高游戏性能。

#### 2. 动态时间步（Dynamic Time Step）
在一些情况下，物理引擎可以根据场景中的复杂度和性能需求动态调整物理帧的时间步长，从而优化性能。
