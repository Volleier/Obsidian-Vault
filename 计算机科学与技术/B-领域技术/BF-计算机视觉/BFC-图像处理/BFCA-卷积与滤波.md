# 介绍
**卷积是实现滤波的主要数学工具，而滤波是卷积运算在信号/图像处理中的一个核心应用目标。**
## 卷积（Convolution）
卷积可以理解为一种“滑动加权求和”或“用一个小函数去扫描另一个函数/信号/图像”。
- 你有一个输入信号/图像 $x$（原始数据）
- 你有一个核/卷积核 $h$（一组权重、模板、掩模）
- 把 $h$ 在 $x$ 上平移，每到一个位置就把“重叠部分相乘再相加”，得到输出 $y$

卷积核 $h$ 描述了你希望从输入中提取什么：
- “平均一下”→ 平滑/去噪（低通）
- “算差分”→ 边缘/细节（高通）
- “强调中心抑制周围”→ 锐化

### 数学定义
#### 连续形式
对连续时间/连续空间信号：

$$
(x*h)(t) = \int_{-\infty}^{+\infty} x(\tau)\,h(t-\tau)\,d\tau
$$

关键点：$h(t-\tau)$ 表示“先把核翻转，再平移到 $t$”。

#### 离散形式
对离散序列 $x[n]$ 与核 $h[n]$：

$$
(x*h)[n] = \sum_{k=-\infty}^{+\infty} x[k]\,h[n-k]
$$

如果 $h$ 只有有限长度，求和就只在核的支持范围内进行。

#### 离散 2D

图像可以看作 2D 离散信号 $I[i,j]$。使用 2D 卷积核 $K[u,v]$ 时：

$$
(I*K)[i,j] = \sum_u\sum_v I[i-u,\,j-v]\,K[u,v]
$$

在实现时常写成“在像素邻域做乘加”。同样注意：严格的卷积包含核的翻转；许多视觉/深度学习框架实现的“卷积层”实际做的是互相关（Correlation，见后文），但大家习惯上仍称为 convolution。


# 滤波（Filtering）

## 滤波是什么

滤波（filtering）的目标是“改变信号/图像的某些成分，同时尽量保留其它成分”。

常见目标：

- 去噪：压低随机噪声，保留结构（平滑滤波）
- 提取边缘：强调强梯度位置（边缘检测）
- 锐化：增强细节与纹理
- 特征增强/抑制：例如去除条纹、去除背景趋势、强调特定方向纹理

## 滤波的分类（常用视角）

### 1）线性 vs 非线性

- 线性滤波：输出是输入的线性组合。典型就是“用一个核做卷积”。
- 非线性滤波：输出不是线性组合，例如中值滤波（Median）、双边滤波（Bilateral）、形态学（腐蚀/膨胀）等。

### 2）空域（空间域） vs 频域

- 空域滤波：直接在像素邻域对灰度/颜色做运算（卷积、排序、形态学）。
- 频域滤波：把信号变换到频域（如傅里叶变换），在频域乘上某个频率响应，再变换回来。

### 3）低通 vs 高通（按频率意义）

- 低通（Low-pass）：保留低频，抑制高频 → 平滑、去噪，但会变“糊”。
- 高通（High-pass）：保留高频，抑制低频 → 强调边缘与细节，但也会放大噪声。

---

# 卷积与滤波的关系

## 关系一句话

在信号/图像处理中：

- **滤波是目的（想要什么效果）**
- **卷积是实现许多线性滤波的主要工具（怎么做）**

## 为什么卷积能“表示滤波”

对“线性且平移不变（Linear Shift-Invariant, LSI）”的系统/算子，有一个非常重要的结论：

- 系统完全由它的“单位冲激响应”决定
- 任何输入的输出，都等于输入与该冲激响应的卷积

也就是说：

- 把滤波器（线性、平移不变）看成一个系统 $H$
- 用一个核 $h$ 表示它对“冲激”的响应
- 那么对任意输入 $x$，输出 $y$ 就是 $y=x*h$

在图像里，$h$ 就是卷积核（模板/掩模）。

## 频域视角（卷积定理）

卷积与傅里叶变换之间有经典关系：

$$
\mathcal{F}\{x*h\} = \mathcal{F}\{x\}\,\mathcal{F}\{h\}
$$

含义：

- **空域卷积 ⇔ 频域相乘**
- 一个滤波器的“频率响应”本质上是核 $h$ 的频谱

所以“低通/高通”等滤波概念，既可以在空域用卷积核理解，也可以在频域用频率响应理解。

## 卷积 vs 互相关（很容易混）

互相关（Correlation）常见形式：

$$
(x\star h)[n] = \sum_k x[n+k]\,h[k]
$$

它与卷积的差别核心在于：卷积包含对核的翻转（$h[n-k]$），互相关不翻转。

工程上：

- 许多经典对称核（如均值核、高斯核）翻不翻转都一样
- 深度学习里常把互相关实现称作 convolution（因为学习到的权重会“自行适配”这个差别）

---

# 卷积详解（更“细”的理解与工程要点）

## 1）卷积核（Kernel）的意义

卷积核可以理解为“局部邻域的权重模板”。对于 2D 图像：

- 核大小：$3\times3$、$5\times5$、$7\times7$…
- 核系数：决定如何组合邻域像素

一个非常常用的直觉：

- 核系数和为 1 → 倾向于保持整体亮度（平滑类常见）
- 核系数和为 0 → 倾向于对变化敏感（边缘/梯度类常见）

## 2）边界处理（Padding / 边界条件）

卷积在图像边缘会遇到“核伸出图像外”的问题，常见处理：

- Zero padding：外部补 0（简单，但边缘可能变暗/出现伪影）
- Replicate：用边缘像素复制填充
- Reflect/Mirror：镜像填充（视觉上更自然）
- Valid：只在核完全落在图像内部时计算（输出尺寸变小）

不同边界条件会导致边缘附近结果不同，比较/复现实验时要明确说明。

## 3）输出尺寸与“滑动方式”（Stride 等概念）

在传统图像处理里，卷积核通常每次平移 1 个像素（stride=1）。

在深度学习里还会常见：

- stride>1：下采样（输出更小）
- dilation（空洞卷积）：扩大感受野但不增加参数

如果你这篇笔记主要面向“经典滤波”，记住 stride=1、dilation=1 就够用了。

## 4）可分离卷积（Separable Convolution）

有些 2D 核可以拆成两个 1D 核的外积：

$$
K = a\,b^T
$$

那么 2D 卷积就可以先做一次水平 1D 卷积，再做一次垂直 1D 卷积，复杂度从 $O(k^2)$ 降到 $O(2k)$。

典型例子：高斯核是可分离的。

## 5）计算加速：FFT 卷积（大核/大图像）

当核很大时，直接空域卷积代价高；利用卷积定理可以：

- 对输入与核做 FFT
- 频域相乘
- IFFT 回到空域

这是许多库在大核场景下的常用优化思路。

---

# 例子（可手算）

下面例子都按“离散卷积”的乘加规则来，方便你把概念落地。

## 例 1：1D 三点均值滤波（平滑/低通）

输入序列：

$$x = [1,\ 2,\ 3,\ 4,\ 5]$$

取一个 3 点均值核：

$$h = \frac{1}{3}[1,\ 1,\ 1]$$

用“same 输出 + 边界忽略/只算中间（valid）”的方式，先算中间三个位置（对应输入 2、3、4 的中心）：

- 位置对齐到 $[1,2,3]$：$y=\frac{1}{3}(1+2+3)=2$
- 位置对齐到 $[2,3,4]$：$y=\frac{1}{3}(2+3+4)=3$
- 位置对齐到 $[3,4,5]$：$y=\frac{1}{3}(3+4+5)=4$

输出（valid）：

$$y = [2,\ 3,\ 4]$$

解释：把局部 3 个点平均一下，会压制快速波动（高频），达到平滑效果。

## 例 2：1D 一阶差分核（边缘/高通思想）

差分核（一种简单“高通/变化检测”）：

$$h=[-1,\ 1]$$

对同样的 $x=[1,2,3,4,5]$，按相邻差：

- $2-1=1$
- $3-2=1$
- $4-3=1$
- $5-4=1$

输出（valid）：

$$y=[1,1,1,1]$$

解释：差分对“变化”敏感，对“常量/缓慢变化”不敏感。

## 例 3：2D 均值滤波（3×3 Box Blur）

3×3 均值核：

$$
K=\frac{1}{9}
\begin{bmatrix}
1&1&1\\
1&1&1\\
1&1&1
\end{bmatrix}
$$

假设某个像素的 3×3 邻域灰度为：

$$
P=
\begin{bmatrix}
10&10&10\\
10&20&10\\
10&10&10
\end{bmatrix}
$$

那么该像素卷积输出就是邻域平均：

$$
y=\frac{1}{9}(10\times8 + 20) = \frac{100}{9}\approx 11.11
$$

解释：中心的“突起”被平均掉了，典型去噪/平滑效果。

## 例 4：2D Sobel 算子（边缘检测）

Sobel 在 x 方向的核（检测垂直边缘）：

$$
K_x=
\begin{bmatrix}
-1&0&1\\
-2&0&2\\
-1&0&1
\end{bmatrix}
$$

它本质是“加权差分”，对左暗右亮（或相反）的变化响应大。

实际使用常同时计算 $G_x$ 与 $G_y$，再组合梯度幅值：

$$
G=\sqrt{G_x^2+G_y^2}
$$

这就是把“滤波目标：边缘”通过“卷积实现：Sobel 核”落地的典型例子。

## 例 5：锐化（Unsharp Mask 思路）

锐化常见做法：

1. 先用低通核得到平滑图 $B$（blurred）
2. 细节（高频）近似为 $D = I - B$
3. 把细节加回去：$I' = I + \alpha D$

这里的“低通”“相减”“再相加”本质仍是线性运算的组合，其中关键步骤就是卷积平滑。

---

# 小结

- 卷积：一种通用的“滑动乘加”运算；在 LSI 场景下，输出可表示为输入与核的卷积。
- 滤波：目的导向的处理（去噪、边缘、锐化…）；线性空域滤波通常可由卷积核实现。
- 关系：**滤波是应用目标，卷积是常见实现手段**；频域里体现为空域卷积对应频域乘法。

