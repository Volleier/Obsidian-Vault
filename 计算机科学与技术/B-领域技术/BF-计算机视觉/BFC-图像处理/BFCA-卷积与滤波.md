# 介绍
**卷积是实现滤波的主要数学工具，而滤波是卷积运算在信号/图像处理中的一个核心应用目标。**
## 卷积
**卷积（Convolution），又称褶积，是泛函分析中通过两个函数生成第三个函数的积分变换运算，本质上是函数翻转平移后重叠部分的乘积积分**。该运算可视为滑动平均的推广形式，在信号处理、概率论等领域具有基础性作用。 
卷积的数学定义为：对两个可积函数$f(x)$和$g(x)$进行积分运算生成新函数，满足交换律与结合律。其与傅里叶变换存在对应关系——时域卷积等价于频域乘积，该性质被广泛应用于快速算法设计。卷积运算可使函数光滑化，成为函数正则化的重要手段。

卷积在许多领域有重要引用，在本章笔记中，卷积多为在计算机视觉中的卷积。而具体到计算机视觉中的卷积，可以理解为一种“滑动加权求和”或“用一个小函数去扫描另一个函数/信号/图像”。
- 你有一个输入信号/图像 $x$（原始数据）
- 你有一个核/卷积核 $h$（一组权重、模板、掩模）
- 把 $h$ 在 $x$ 上平移，每到一个位置就把“重叠部分相乘再相加”，得到输出 $y$

卷积核 $h$ 描述了你希望从输入中提取什么：
- “平均一下”→ 平滑/去噪（低通）
- “算差分”→ 边缘/细节（高通）
- “强调中心抑制周围”→ 锐化

### 数学定义
#### 连续形式
对连续时间/连续空间信号：

$$
(x*h)(t) = \int_{-\infty}^{+\infty} x(\tau)\,h(t-\tau)\,d\tau
$$

关键点：$h(t-\tau)$ 表示“先把核翻转，再平移到 $t$”。

#### 离散形式
对离散序列 $x[n]$ 与核 $h[n]$：

$$
(x*h)[n] = \sum_{k=-\infty}^{+\infty} x[k]\,h[n-k]
$$

如果 $h$ 只有有限长度，求和就只在核的支持范围内进行。

#### 离散 2D

图像可以看作 2D 离散信号 $I[i,j]$。使用 2D 卷积核 $K[u,v]$ 时：

$$
(I*K)[i,j] = \sum_u\sum_v I[i-u,\,j-v]\,K[u,v]
$$

在实现时常写成“在像素邻域做乘加”。同样注意：严格的卷积包含核的翻转；许多视觉/深度学习框架实现的“卷积层”实际做的是互相关（Correlation，见后文），但大家习惯上仍称为 convolution。


## 滤波
**滤波（Wave filtering）是将信号中特定波段频率滤除的操作，是抑制和防止干扰的一项重要措施**。滤波分为经典滤波和现代滤波。

常见目标：
- 去噪：压低随机噪声，保留结构（平滑滤波）
- 提取边缘：强调强梯度位置（边缘检测）
- 锐化：增强细节与纹理
- 特征增强/抑制：例如去除条纹、去除背景趋势、强调特定方向纹理

### 滤波的分类
#### 线性 vs 非线性
- 线性滤波：输出是输入的线性组合。典型就是“用一个核做卷积”。
- 非线性滤波：输出不是线性组合，例如中值滤波（Median）、双边滤波（Bilateral）、形态学（腐蚀/膨胀）等。

#### 空域 vs 频域
- 空域滤波：直接在像素邻域对灰度/颜色做运算（卷积、排序、形态学）。
- 频域滤波：把信号变换到频域（如傅里叶变换），在频域乘上某个频率响应，再变换回来。

#### 低通 vs 高通
- 低通（Low-pass）：保留低频，抑制高频 → 平滑、去噪，但会变“糊”。
- 高通（High-pass）：保留高频，抑制低频 → 强调边缘与细节，但也会放大噪声。

## 卷积与滤波的关系
在信号/图像处理中：
- **滤波是目的**
- **卷积是实现许多线性滤波的主要工具**

为什么卷积能“表示滤波”
对“线性且平移不变（Linear Shift-Invariant, LSI）”的系统/算子，有一个非常重要的结论：
- 系统完全由它的“单位冲激响应”决定
- 任何输入的输出，都等于输入与该冲激响应的卷积

也就是说：
- 把滤波器（线性、平移不变）看成一个系统 $H$
- 用一个核 $h$ 表示它对“冲激”的响应
- 那么对任意输入 $x$，输出 $y$ 就是 $y=x*h$

在图像里，$h$ 就是卷积核（模板/掩模）。


# 线性滤波（Linear Filtering）
## 一、图像表示基础

计算机视觉里，图像本质上是一个（或多个）离散采样的二维数组。

### 1）二值图像（Binary Image）

- 每个像素只有两种取值：0/1（或黑/白）
- 常用于前景/背景分割后的掩码、形态学处理等

### 2）灰度图像（Grayscale Image）

- 单通道强度值：$I(x,y)$
- 常见位深：8-bit（0~255），也可能是 16-bit 或浮点
- 视觉上表示亮度/强度

### 3）彩色图像（Color Image）

- 多通道：最常见是 RGB（三通道）
- 可视为张量 $I(x,y,c)$，其中 $c\in\{R,G,B\}$
- 线性滤波通常可以：
	- 对每个通道分别滤波（最常见、最简单）
	- 或在某些颜色空间（如 Lab）对亮度通道优先处理

## 二、滤波动机：图像去噪

很多滤波从“去噪”这个问题切入：照片/图像会因为传感器、低照度、传输误码等产生噪声。

一个非常核心的思路是：

- **用像素邻域的加权平均替代原像素值**
- “加权怎么取”由**滤波器/卷积核**决定

写成卷积形式就是：

$$I' = I * K$$

其中 $K$ 就是滤波器（卷积核）。

---

## 三、卷积：定义与计算（线性滤波视角）

在线性滤波语境下，卷积是最常用的空域实现方式：

$$
(I*K)[i,j] = \sum_u\sum_v I[i-u,\,j-v]\,K[u,v]
$$

### 卷积的关键性质（课程常考点）

设 $*$ 表示卷积，$a,b$ 为常数，$f,g,h$ 为信号/图像（或核），则：

1）线性性（Linearity）

$$
(a f + b g) * h = a(f*h) + b(g*h)
$$

2）平移不变性（Shift Invariance）

- 输入平移多少，输出也平移多少（卷积核本身不随位置改变）

3）交换律（Commutativity）

$$f*g = g*f$$

4）结合律（Associativity）

$$ (f*g)*h = f*(g*h) $$

5）分配律（Distributivity）

$$ f*(g+h) = f*g + f*h $$

6）单位脉冲响应（Impulse Response）

对线性且平移不变（LSI）的系统/滤波器：

- 系统由它对单位冲激 $\delta$ 的响应完全决定
- 该响应就是卷积核/冲激响应 $h$
- 任意输入的输出：$y=x*h$

这一点就是“卷积能表示线性滤波”的理论基础。

---

## 四、卷积实现中的细节问题

### 1）输出尺寸计算：full / same / valid

先给出最常用的 1D 结论，2D 对高和宽分别套用即可。

设输入长度为 $N$，核长度为 $K$。

- **valid（不填充）**：
	- 输出长度：$N_{out}=N-K+1$
- **full（完全卷积）**：
	- 输出长度：$N_{out}=N+K-1$
- **same（输出与输入同长）**：
	- 需要 padding；当 $K$ 为奇数且 stride=1 时，常取 $p=\lfloor K/2\rfloor$
	- 输出长度：$N_{out}=N$

更一般地（含 stride 与 padding），1D 输出长度常用公式：

$$
N_{out}=\left\lfloor\frac{N + 2p - K}{s}\right\rfloor + 1
$$

2D 情况对高度 $H$、宽度 $W$ 分别使用：

$$
H_{out}=\left\lfloor\frac{H + 2p_h - K_h}{s_h}\right\rfloor + 1,\quad
W_{out}=\left\lfloor\frac{W + 2p_w - K_w}{s_w}\right\rfloor + 1
$$

### 2）边缘处理（当窗口超出图像边界）

卷积核在图像边界处会“伸出图像外”，必须定义边界条件。课程里常见几种：

- **截断 / 补零（黑边）**：越界位置当作 0（实现简单，但边缘可能变暗或出现伪影）
- **循环填充（Wrap/Circular）**：越界从另一侧“绕回去”（适合周期信号假设）
- **复制边缘像素（Replicate/Clamp）**：越界用最近的边缘像素值填充
- **镜像反射（Reflect/Mirror）**：以边界为镜面对称填充（视觉上通常更自然）

不同边界策略会导致边缘附近结果不同；复现实验或写报告时需要说明。

---

## 五、常见线性滤波器示例

### 1）平滑滤波器（Smoothing / Low-pass）

**平均滤波（Box/Mean Filter）**：

$$
K=\frac{1}{9}
\begin{bmatrix}
1&1&1\\
1&1&1\\
1&1&1
\end{bmatrix}
$$

特点：简单、去噪明显，但容易把边缘也一起“抹糊”。

### 2）锐化滤波器（Sharpening / High-boost）

锐化的直觉：

- 模糊得到低频（平滑结果）
- 用“原图 - 模糊图”得到细节（高频）
- 把细节按比例加回去

一种常见写法（非锐化掩模 Unsharp Mask）：

$$
I' = I + \alpha\,(I - (I*K_{blur}))
$$

其中 $K_{blur}$ 常选均值核或高斯核，$\alpha>0$ 控制锐化强度。

**拉普拉斯（Laplacian）锐化**也常见，例如：

$$
K_{lap}=
\begin{bmatrix}
0&-1&0\\
-1&4&-1\\
0&-1&0
\end{bmatrix}
$$

用它做卷积可突出二阶变化（对边缘敏感），再与原图组合实现锐化。

---

## 六、高斯滤波（Gaussian Filtering）

高斯滤波可以看作“更合理的加权平均”：离中心越近权重越大，离中心越远权重越小。

### 1）高斯函数与核

1D 高斯：

$$
G(x)=\frac{1}{\sqrt{2\pi}\,\sigma}\,e^{-\frac{x^2}{2\sigma^2}}
$$

2D 高斯：

$$
G(x,y)=\frac{1}{2\pi\sigma^2}\,e^{-\frac{x^2+y^2}{2\sigma^2}}
$$

离散高斯核通常做法：

- 选定 $\sigma$
- 取核大小约为 $\lceil 6\sigma\rceil+1$（等价于半宽约 $3\sigma$）
- 计算每个离散位置的高斯值
- 再把所有权重归一化（保证权重和为 1）

### 2）高斯滤波 vs 盒滤波（均值滤波）

- 盒滤波：所有邻域权重相同 → 容易产生不自然的“块感”/振铃倾向
- 高斯滤波：权重平滑衰减 → 更符合自然图像的平滑假设，效果通常更柔和

### 3）高斯核的可分离性（Separable）

高斯核满足：

$$
G(x,y)=G(x)\,G(y)
$$

含义：二维高斯卷积可以拆成两次一维卷积：

1. 先做水平 1D 高斯
2. 再做垂直 1D 高斯

复杂度从 $O(k^2)$ 降到 $O(2k)$，在大核时能显著加速。

---

## 七、噪声类型与去噪方法（含对比）

### 1）高斯噪声（Gaussian Noise）

- 特点：噪声幅度近似服从正态分布，整体“颗粒状”
- 常用方法：**高斯滤波**（线性平滑）能有效抑制，但会牺牲一定细节

### 2）椒盐噪声（Salt-and-Pepper Noise）

- 特点：随机出现极亮点（盐）或极暗点（椒），是强离群值
- 经验结论：**中值滤波（Median Filter）通常更有效**

注意：中值滤波是**非线性**滤波（不属于线性滤波范畴），但在课程里常作为去噪对比一起讲。

对比要点：

- 高斯滤波：线性、加权平均，对离群点不够“硬”，容易把离群点扩散成模糊斑
- 中值滤波：非线性、排序取中值，对离群点鲁棒，保边能力通常更好

## 小结（线性滤波这一讲的主线）

- 图像可视为二维（多通道）离散信号；滤波常从去噪动机切入。
- 线性滤波常用卷积实现；卷积具备线性性、平移不变性等关键性质，并与单位脉冲响应紧密相关。
- 实现时要明确输出尺寸模式（full/same/valid）与边界处理策略。
- 常见线性滤波包括平滑（均值/高斯）与锐化（拉普拉斯、非锐化掩模）。
- 高斯核具有可分离性，能显著降低计算量；椒盐噪声则常用中值滤波（非线性）更有效。