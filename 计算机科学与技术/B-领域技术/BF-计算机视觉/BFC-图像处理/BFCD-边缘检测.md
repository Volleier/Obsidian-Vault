# 介绍

**边缘检测（Edge Detection）** 的目标是识别图像中亮度或强度发生突然变化（不连续）的区域。边缘通常承载了图像中最重要的语义与形状信息。

边缘产生的原因：

1. 表面法线不连续：物体的几何拐角、转折。
2. 深度不连续：物体之间的遮挡关系。
3. 表面颜色（反射率）不连续：物体的纹理或图案变化。
4. 光照不连续：阴影边界。

边缘检测的目标：

- 紧凑性：将“像素级强度场”转化为“结构化的轮廓/边界”。
- 准确性：边缘位置应尽可能精确。
- 稳定性：对噪声有良好的抑制能力。

# 数学基础

## 图像梯度和梯度算子

**图像梯度是二维离散函数的求导运算，通过对图像像素值的差分计算来描述图像局部区域的变化率，广泛应用于图像边缘检测等计算机视觉任务。** 而梯度算子是计算图像梯度的算子，是计算图像区域变化值的数学工具。

**梯度算子（Gradient operator）是用于计算多元函数在各变量方向变化率的向量算子，其数学符号为 ∇（nabla）**。

作为描述物理场变化的基本工具，梯度算子作用于标量场时形成梯度。在不同正交坐标系中，其运算形式存在差异，如柱坐标系中表现为径向、角向和轴向分量的组合，球坐标系中则涉及球面坐标系的特定展开。

梯度向量：

$$
\nabla I = \left[\frac{\partial I}{\partial x},\ \frac{\partial I}{\partial y}\right]^T
$$

- 梯度方向：指向强度增加最快的方向，与边缘方向垂直。
- 梯度幅值 $M$：边缘的强度。
  $$M = \sqrt{G_x^2 + G_y^2} \approx |G_x| + |G_y|$$

### 常见一阶梯度算子

#### 常见一阶梯度算子对比

| 算子                       |          窗口 | 是否含平滑   | 旋转一致性 |       抗噪性 |         定位精度 |          计算复杂度 |
| -------------------------- | ------------: | ------------ | ---------: | -----------: | ---------------: | ------------------: |
| Roberts                    |           2×2 | 否           |         差 |         很差 |             很高 |                极低 |
| Prewitt                    |           3×3 | 弱，等权     |       一般 |         一般 |             中等 |                  低 |
| Sobel                      |           3×3 | 有中心权重   |       一般 |         较好 |             较好 |        低（可分离） |
| Scharr                     |           3×3 | 有改进权重   |         好 |         较好 |             更好 |    低（类似 Sobel） |
| 中心差分（Central）        |     1×3 / 3×1 | 否，对称     |         好 |         很差 |               高 |                极低 |
| 高斯导数（Gaussian ∂）     |  可变（随 σ） | 有可调 σ     | 随核设计好 | 很好（可调） |        随 σ 可控 | 中—高（核越大越慢） |
| Compass（Kirsch/Robinson） | 多方向 3×3 组 | 通常无       |         差 |           差 | 中等（方向量化） |    中等（多次卷积） |
| Frei–Chen                  |      3×3 基组 | 部分有基展开 |       较好 |         中等 |             中等 |                中等 |

#### Roberts Cross（罗伯茨交叉算子）

- 核（两个 2×2）：
  - Gx ≈ [[+1, 0],[0, -1]]，Gy ≈ [[0, +1],[-1, 0]]（或等价变体）
- 特性：窗口最小（2×2），计算量小，敏感噪声。
- 优点：定位精确（对极窄边缘敏感），实现简单。
- 缺点：对噪声极其敏感；方向分辨率低；不对称。
- 适用：资源极其受限或做历史/教育性对比。

#### Prewitt 算子

- 核（3×3，均匀平滑）： - Kx = [[-1,0,1],[-1,0,1],[-1,0,1]]，Ky 转置
  - 特性：等权平滑（列/行求和），简单的差分+平均。
  - 优点：比 Roberts 更稳健（对噪声稍好），实现简单且可分离。
  - 缺点：定位与旋转对称性不如 Scharr；响应偏粗。
  - 适用：简单边缘检测、教学示例、实时低复杂度场景。

#### Sobel（Sobel–Feldman）算子

- 核（3×3，带中心加权）： - Kx = [[-1,0,1],[-2,0,2],[-1,0,1]]，Ky 转置
  - 特性：在差分的同时做小范围平滑（中间权 2），可分离实现（$[1 2 1]$ 与 $[-1 0 1]$）。
  - 优点：较强噪声抑制，定位适中，广泛使用。
  - 缺点：方向精度有限（4 主方向量化），对旋转不完全对称。
  - 适用：工程中最常见的梯度算子之一，实用性强。

#### Scharr 算子

- 核（改进的 3×3 权重以提高旋转对称性）：例如 $Kx ≈ [[3,0,-3],[10,0,-10],[3,0,-3]]$（归一化形式）
  - 特性：为提高离散近似的角向（旋转）一致性而设计，能更好逼近连续导数的方向性。
  - 优点：比 Sobel 在角度近似上更准确，尤其在小核（3×3）上效果好。
  - 缺点：权重更大，数值上需归一化；与 Sobel 相比差别在某些场景不明显。
  - 适用：需要更好旋转对称性但仍受限于小窗口的场景。

#### Frei–Chen 算子

- 核：一组 9 个基（包含近似导数与不同方向），设计用于更全面的局部基础展开。
  - 特性：理论上以一组基滤波器对图像局部做投影分析，可用于鲁棒性和方向性分析。
  - 优点：更丰富的方向/分解信息。
  - 缺点：较复杂，较少作为直接工程默认选择。
  - 适用：研究/特定特征描述场景。

#### 中点/中心差分（Central Difference）

- 核（1D）：$[-1, 0, +1]$ / 纵向转置（或缩放为 $[-0.5, 0, 0.5]$）
  - 特性：简单、对称的一阶差分，频域表现与精确性较好。
  - 优点：数值对称，定位好，易于理解与实现。
  - 缺点：无平滑，噪声敏感；通常与平滑（如高斯）结合使用。
  - 适用：在预先已平滑（或噪声低）的图像上做精确导数估计。

#### 高斯导数（Gaussian derivative / DoG 一阶近似）

- 核：对高斯核求一阶导得到的连续核（可分离）：G_x = ∂G/∂x，G_y = ∂G/∂y。
  - 特性：正式实现“先平滑再求导”的方法；尺度（σ）可控。
  - 优点：抗噪能力可调（通过 σ），数学光滑且可分离，尺度空间理论支持。
  - 缺点：计算量随核尺寸增加；需要选择合适 σ。
  - 适用：高质量边缘检测（如 Canny 更规范地使用高斯导数而非简单 Sobel）。

#### Derivative of Gaussian (DoG) 近似 / LoG（注意：LoG 为二阶）

- 特性：DoG 常作一阶/二阶近似工具；LoG（Laplacian of Gaussian） 是二阶用于零交叉检测，不直接给出梯度向量，但可用于边缘定位。
  - 适用：尺度空间分析、边缘增强与曲率、零交叉边缘定位。

#### Compass / 八方向滤波器（例如 Kirsch、Robinson）

- 核：一组多个方向的模板（通常 3×3），分别强调不同方向上的响应。
  - 特性：输出并非明确的 Gx,Gy，而是各方向响应的集合，可取最大作为边缘强度。
  - 优点：方向检测明确，能强调某些方向的边缘。
  - 缺点：不是严格的微分算子；对噪声敏感；旋转等价性差。
  - 适用：需要突出特定方向纹理或快速检测强方向性边缘的场景。

### 常见二阶梯度算子

#### 拉普拉斯算子

##### 概述

拉普拉斯（Laplacian）是二阶微分算子，用于测量图像强度场的“变化的变化”（曲率）。与一阶梯度算子输出向量不同，拉普拉斯输出一个标量场，常用于边缘零交叉定位、边缘增强与锐化。

数学定义

$$
\nabla^2 I = \left[\frac{\partial^2 I}{\partial x^2},\ \frac{\partial^2 I}{\partial y^2}\right]^T
$$

##### 离散近似（常见模板）

- 4-邻域：
  $$ \begin{bmatrix} 0 & -1 & 0 \\ -1 & 4 & -1 \\ 0 & -1 & 0 \end{bmatrix} $$
- 8-邻域：
  $$ \begin{bmatrix} -1 & -1 & -1 \\ -1 & 8 & -1 \\ -1 & -1 & -1 \end{bmatrix} $$

**Laplacian of Gaussian (LoG)**  
为降低噪声影响，通常先做高斯平滑再做拉普拉斯，或直接用 LoG（对高斯求二阶导）：
$$LoG(x,y)=\nabla^2G(x,y;\sigma)=(\frac{x^2+y^2−2\sigma^2}{\sigma^4})G(x,y;\sigma)$$
零交叉（zero-crossing）位置常被视为边缘。

#### 优缺点

##### 优点

- 各向同性（对方向无偏）
- 能检测“零交叉”型边缘与曲率信息，适合多尺度分析

##### 缺点

- 二阶导对高频噪声放大，必须平滑
- 不能直接给出边缘方向
- 零交叉检测对噪声与量化敏感，需要阈值/后处理

## 导数性质

- 一阶导数：图像强度的突变处表现为一阶导数的极值点。
- 二阶导数：图像强度的突变处表现为二阶导数的过零点。

## 3. 噪声抑制与高斯导数

微分操作本质上是“高通”滤波，会对高频噪声产生显著的放大作用。因此，边缘检测通常遵循 “先平滑，再求导” 的工作流。

### 3.1 结合性原理

根据卷积的结合性：
$$\frac{\partial}{\partial x}(I * G) = I * \frac{\partial G}{\partial x}$$
这意味着我们可以将高斯平滑核与导数算子合并为 **高斯导数滤波器 (Gaussian Derivative Filters)**，仅通过一次卷积即可完成去噪与提取导数的功能。

### 3.2 高斯导数核的特性

- **尺度参数 $\sigma$**：
  - $\sigma$ 较大：抗躁强，但边缘定位模糊。
  - $\sigma$ 较小：定位精确，但对噪声敏感。
- **可分离性 (Separability)**：
  - 计算 $G_x$：在 $x$ 方向应用高斯导数核，在 $y$ 方向应用标准一维高斯核。这可以极大提升计算效率。

# 图像检测算法

## Canny 边缘检测算法

Canny 是边缘检测的事实标准，它旨在实现低错误率、良好的定位以及单像素响应。

### 实现步骤

1. 高斯平滑：抑制高频噪声。
2. 计算梯度幅值与方向：通常使用 Sobel 算子获取 $M$ 和 $\theta$。
3. 非极大值抑制 (NMS)：
   - 目标：将粗大的梯度响应“瘦身”为单像素宽的边缘。
   - 逻辑：沿着梯度方向 $\theta$ 检查邻域，若当前像素幅值不是局部最大值，则将其置为 0。
   - 方式：支持“方向量化”（4 个主方向）或“线性插值”（更高精度）。
4. 滞后阈值 (Hysteresis Thresholding)：
   - 设定高阈值 $T_H$ 和低阈值 $T_L$。
   - 强边缘：$M > T_H$，保留。
   - 弱边缘：$T_L < M < T_H$，仅当其与强边缘连通时才保留。
   - 噪声：$M < T_L$，剔除。
