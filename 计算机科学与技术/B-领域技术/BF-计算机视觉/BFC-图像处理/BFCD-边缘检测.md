
# 介绍
**边缘检测（Edge Detection）的目标是识别图像中强度突然变化（不连续） 的区域**。因为边缘往往包含丰富的语义与形状信息且相比直接处理像素，边缘表达更紧凑。边缘检测通常用于把图像从“像素级强度场”转化为“结构化的轮廓/边界信息”，为后续任务提供更稳定的输入。

实现边缘检测的最基本、最重要的数学工具是梯度算子。

边缘的产生原因：
1. 表面法线不连续
2. 深度不连续
3. 表面颜色不连续
4. 光照不连续

要实现图形的边缘检测，要对边缘进行数学刻画：
把图像看作二维函数 $f(x,y)$，边缘对应 $f$ 的快速变化
- 一阶导数的极值（或梯度幅值的局部大值）常对应边缘位置
- 在许多经典方法中：先估计导数（梯度/二阶导），再做阈值化与细化

# 核心概念
## 利用卷积计算导数
在离散图像上，偏导数通常用有限差分近似。例如 x 方向前向差分：

$$
\frac{\partial f}{\partial x}(x,y) \approx f(x+1,y) - f(x,y)
$$

这可以用卷积核实现：
- 2D（检测垂直边缘）：$\begin{bmatrix}-1&1\end{bmatrix}$
- 2D（检测水平边缘）：$\begin{bmatrix}-1\\1\end{bmatrix}$

## 噪声影响与“先平滑再求导”
噪声会显著放大导数估计的不稳定性（导数本身是“高通”操作）。经典处理思路是：

- **先平滑再求导**

利用卷积的结合性/线性以及微分与卷积的关系，可以把“平滑 + 求导”合并为一次卷积：

$$
\frac{\partial}{\partial x}(f * g) = f * \frac{\partial g}{\partial x}
$$

因此常用 **高斯导数滤波器（Gaussian Derivative）**：既平滑又求导，且可分离实现。

---

## 高斯导数滤波器（Gaussian Derivative Filters）

### 高斯核与尺度参数 $\sigma$

2D 高斯（回顾）：

$$
G(x,y,\sigma)=\frac{1}{2\pi\sigma^2}\,e^{-\frac{x^2+y^2}{2\sigma^2}}
$$

$\sigma$ 控制尺度：

- $\sigma$ 越大：更强平滑、抗噪更强，但边缘定位更模糊
- $\sigma$ 越小：定位更精确，但更容易受噪声影响

### 2）高斯在 x/y 方向的一阶导数

高斯在 x 方向的一阶导（形式上）：

$$
\frac{\partial G}{\partial x} = -\frac{x}{\sigma^2}G(x,y,\sigma)
$$

同理：

$$
\frac{\partial G}{\partial y} = -\frac{y}{\sigma^2}G(x,y,\sigma)
$$

用法：

- $G_x = I * \frac{\partial G}{\partial x}$
- $G_y = I * \frac{\partial G}{\partial y}$

### 3）可分离性（高效计算）

高斯满足可分离：$G(x,y)=G(x)G(y)$，因此高斯导数也可以用一维核分步计算：

- $\frac{\partial G}{\partial x}$：在 x 方向用“高斯导数”，在 y 方向用“高斯平滑”
- $\frac{\partial G}{\partial y}$：在 y 方向用“高斯导数”，在 x 方向用“高斯平滑”

---

## 平滑滤波器 vs 导数滤波器（对比）

| 特性   | 平滑滤波器（如高斯）     | 导数滤波器（如高斯导数）  |
| ------ | ------------------------ | ------------------------- |
| 作用   | 低通滤波，去高频噪声     | 高通滤波，提取边缘        |
| 值范围 | 全正，和为 1（归一化后） | 可正可负，和为 0（典型）  |
| 响应   | 对平坦区域影响小         | 对平坦区域无响应/响应很弱 |

# 梯度算子
**梯度算子（Gradient operator）是用于计算多元函数在各变量方向变化率的向量算子，其数学符号为∇（nabla）**。在计算机视觉中，该算子通过Sobel、Prewitt等算法检测像素强度变化，是边缘检测的核心工具。。

作为描述物理场变化的基本工具，梯度算子作用于标量场时形成梯度。在不同正交坐标系中，其运算形式存在差异，如柱坐标系中表现为径向、角向和轴向分量的组合，球坐标系中则涉及球面坐标系的特定展开。
## 图像梯度
梯度向量指向强度增加最快的方向；梯度方向与边缘方向垂直。
对连续函数 $I(x,y)$，梯度为：
$$
\nabla I = \left[\frac{\partial I}{\partial x},\ \frac{\partial I}{\partial y}\right]
$$

常用的边缘强度：
$$
\|\nabla I\| = \sqrt{G_x^2 + G_y^2}
$$
在离散图像上，$G_x,G_y$ 由卷积核近似实现。

梯度方向常用：
$$
	heta = \operatorname{atan2}(G_y, G_x)
$$

# 边缘检测算法
## Canny 边缘检测器

Canny 是经典且工程上非常常用的边缘检测器，目标是得到：

- 单像素宽（细）
- 连通性好
- 抗噪、误检少

典型步骤：

### 1）高斯平滑

用高斯滤波抑制噪声：$I_s = I * G(\sigma)$。

### 2）梯度计算

计算 $G_x,G_y$，得到梯度幅值与方向：

- $M=\sqrt{G_x^2+G_y^2}$
- $\theta=\operatorname{atan2}(G_y,G_x)$

梯度计算可用 Sobel，也可直接用高斯导数（更符合“先平滑再求导”）。

### 3）非极大值抑制（Non-maximum Suppression, NMS）

沿梯度方向（法向方向）只保留局部最大值，把“粗边缘”细化为“细边缘”。

直觉：如果某点不是沿法向的峰值，就把它抑制掉。

更贴近实现的做法（给定梯度幅值 $M$ 与方向 $\theta$）：

1. 对每个像素 $(i,j)$，取其梯度方向 $\theta(i,j)$（通常以弧度或角度表示）。
2. 沿该方向找到“前方/后方”两个比较点的幅值，如果当前不是最大值则置零。

常见有两种实现：

#### A）方向量化（最常见的教材/工程实现）

把 $\theta$ 量化到 4 个主方向（梯度方向，与边缘方向垂直）：

- $0^\circ$（水平方向）：比较 $(i,j-1)$ 与 $(i,j+1)$
- $45^\circ$：比较 $(i-1,j+1)$ 与 $(i+1,j-1)$
- $90^\circ$（竖直方向）：比较 $(i-1,j)$ 与 $(i+1,j)$
- $135^\circ$：比较 $(i-1,j-1)$ 与 $(i+1,j+1)$

量化规则常用把角度映射到 $[0,180^\circ)$，再按区间归类，例如：

- $\theta\in[0,22.5)\cup[157.5,180)$ → $0^\circ$
- $\theta\in[22.5,67.5)$ → $45^\circ$
- $\theta\in[67.5,112.5)$ → $90^\circ$
- $\theta\in[112.5,157.5)$ → $135^\circ$

然后执行：

- 若 $M(i,j) \ge M(p_1)$ 且 $M(i,j) \ge M(p_2)$，保留 $M(i,j)$
- 否则令 $M(i,j)=0$

#### B）线性插值（更精细，方向不量化）

不把方向硬量化，而是沿单位方向向量

$$
\mathbf{d}=(\cos\theta,\ \sin\theta)
$$

在 $+\mathbf{d}$ 与 $-\mathbf{d}$ 上各取一个“亚像素位置”，用双线性插值得到两侧幅值 $M_+$、$M_-$，再比较：

- 若 $M(i,j) \ge M_+$ 且 $M(i,j) \ge M_-$，保留
- 否则置零

插值版通常边缘更细且方向一致性更好，但实现略复杂。

### 4）滞后阈值（Hysteresis Thresholding）

使用高阈值 $T_h$ 与低阈值 $T_l$：

- $M \ge T_h$：强边缘（必保留）
- $T_l \le M < T_h$：弱边缘（仅当与强边缘连通时保留）
- $M < T_l$：抑制

这样能在保留连通结构的同时减少噪声引起的孤立响应。

### 5）输出

得到单像素宽、连通性较好的边缘图。

---

## 十、常见导数/边缘核：Sobel 与拉普拉斯

下面两节保留经典核作为快速查表；更系统的“先平滑再求导”见高斯导数部分。

## Sobel 算子（经典一阶梯度核）

Sobel 在 x 方向的核（检测垂直边缘）：

$$
K_x=
\begin{bmatrix}
-1&0&1\\
-2&0&2\\
-1&0&1
\end{bmatrix}
$$

对应的 y 方向核：

$$
K_y=
\begin{bmatrix}
-1&-2&-1\\
0&0&0\\
1&2&1
\end{bmatrix}
$$

使用方式：

- $G_x = I * K_x$
- $G_y = I * K_y$
- $G = \sqrt{G_x^2 + G_y^2}$（或用 $|G_x|+|G_y|$ 近似）

## 三、拉普拉斯（Laplacian，二阶变化）
拉普拉斯算子近似二阶导数，对“变化的变化”敏感：
$$
\nabla^2 I = \frac{\partial^2 I}{\partial x^2} + \frac{\partial^2 I}{\partial y^2}
$$

离散核：
$$
K_{lap}=
\begin{bmatrix}
0&-1&0\\
-1&4&-1\\
0&-1&0
\end{bmatrix}
$$

拉普拉斯常用于边缘增强或作为锐化的一部分（见去噪与增强）。

---

## 十一、应用与延伸

- 边缘检测是图像分割、目标识别、三维重建等任务的基础模块之一