import bpy

def delete_empty_collections():
    # 获取所有集合名称（避免直接操作迭代中的列表）
    collection_names = [col.name for col in bpy.data.collections]
    deleted = []
    
    # 递归检查是否为空（无对象+无子集合）
    def is_collection_empty(col):
        if len(col.objects) > 0:
            return False
        return all(is_collection_empty(bpy.data.collections[child.name]) 
                  for child in col.children)
    
    # 遍历所有集合名称（避免引用问题）
    for name in collection_names:
        if name not in bpy.data.collections:  # 可能已被前序操作删除
            continue
            
        col = bpy.data.collections[name]
        if is_collection_empty(col):
            try:
                bpy.data.collections.remove(col)
                deleted.append(name)
            except Exception as e:
                print(f"删除失败 {name}: {str(e)}")
    
    print(f"已删除空集合: {deleted}")

# 执行
delete_empty_collections()